$(document).ready(function(){function t(t){return{login:{username:$(".login>:nth-child(1)").val(),password:$(".login>:nth-child(2)").val()},register:{username:$(".register>:nth-child(1)").val(),password:$(".register>:nth-child(2)").val(),confirmPassword:$(".register>:nth-child(3)").val()}}}function e(){const{username:t}=u()||{};t?$.post(v+"/short/getCodeWithUser",{username:t},t=>{h(`共${t.data.length}个URL`),n(t.data)}):h("PLEASE LOGIN")}function o(t){const e=["code","visit","note"],o=`<tr>${e.map(t=>`<th>${t.toUpperCase()}</th>`).join("")}\n        <th>EDIT</th>\n        </tr>`;let n="";for(let o=0;o<t.length;o++)n+=`<tr>${e.map(e=>`<td class="linkLi" title="/${t[o].code}">${t[o][e]}</td>`).join("")}\n            <td class="edit" title="${t[o]._id}">⚙</td>\n            </tr>`;return o+n}function n(t){const e=t&&t.length>0?`<table class="urlList">${o(t)}</table>`:"是空的哦😆";$(".list").html(e),i(),g("list")}function i(){$(".linkLi").click(function(){window.location.href=this.title}),$(".edit").click(function(){$(".edit").removeClass("active"),$(this).addClass("active"),E=this.title,g("edit"),$(".edit_code>input").val(""),$(".edit_note>input").val(""),$(".edit_natter>input").val(""),$(".edit_content>div").hide(),$(".edit_code").show(),$.post(v+"/short/getCodeWithId",{id:this.title},t=>{if(200===t.code){const{code:e,note:o,withNatter:n}=t.data[0]||{};$(".edit_code>input").val(e),$(".edit_note>input").val(o),$(".edit_natter>input").val(n)}})})}function s(t){const{username:e,password:o,email:n,age:i}=t||{};$.post(v+"/users/register",{username:e,password:o,email:n,age:i},function(t){200===t.code?(h(`${t.data.username}注册成功`),g("login")):h(t.data)})}function r(t){const{username:e,password:o}=t||{};$.post(v+"/users/login",{username:e,password:o},function(t){200===t.code?(d({username:e,raw:t.data}),g("short")):h(t.data)})}function a(){localStorage.clear(),h("已登出"),c()}function c(){const{raw:t}=u()||{};t?$.post(v+"/users/getInfo",{raw:t},function(t){200===t.code&&t.data?l(t.data):(l(),h("ERROR PLEASE LOGIN AGAIN"))}):l()}function l(t){$("#user").html(t?`${t.username}[${t.role}]`:""),!t&&localStorage.clear()}function d(t){localStorage.setItem("loginUser",JSON.stringify(t)),h(`${t.username}已登陆`),c()}function u(){return JSON.parse(localStorage.getItem("loginUser"))}function h(t){layer.msg(t||"施工中。。（；´д｀）ゞ",{offset:"10%",time:2500})}function g(t){const e={short:{el:$(".short"),title:"SHORT URL"},login:{el:$(".login"),title:"LOGIN"},register:{el:$(".register"),title:"REGISTER"},list:{el:$(".list"),title:"LIST"},edit:{el:$(".editPage"),title:"EDIT"}};for(let t in e)e.hasOwnProperty(t)&&e[t].el.hide();$(".title").html(e[t].title),e[t].el.show()}function f(){$.post(v+"/short/getUrlCount",function(t){200===t.code&&$("#urlCount").text(t.data)})}function p(t,e){let o=(t,e)=>Math.floor(Math.random()*(Math.floor(e)-Math.ceil(t)+1))+Math.ceil(t);t=t||0,e=e||255;let n=o(t,e),i=o(t,e),s=o(t,e);return`rgb(${n},${i},${s})`}function m(t){let e="((https|http|ftp|rtsp|mms)://)(([a-zA-Z0-9._-]+.[a-zA-Z]{2,6})|([0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}))(:[0-9]{1,4})*(/[a-zA-Z0-9&%_./-~-]*)?",o=new RegExp(e);return o.test(t)}function w(){var t,e,o,n,i,s,r,a;t=window,e=document,o="script",n="SeniverseWeatherWidget",i="//cdn.sencdn.com/widget2/static/js/bundle.js?t="+parseInt(((new Date).getTime()/1e8).toString(),10),a=function(){s=e.createElement(o),r=e.getElementsByTagName(o)[0],s.src=i,s.charset="utf-8",s.async=1,r.parentNode.insertBefore(s,r)},t.SeniverseWeatherWidgetObject=n,t[n]||(t[n]=function(){(t[n].q=t[n].q||[]).push(arguments)}),t[n].l=+new Date,t.attachEvent?t.attachEvent("onload",a):t.addEventListener("load",a,!1),window.SeniverseWeatherWidget("show",{flavor:"bubble",location:"WTTDPCGXTWUS",geolocation:!0,language:"auto",unit:"c",theme:"auto",token:"656f029f-3597-4408-8cd3-fa5cc8e07747",hover:"enabled",container:"tp-weather-widget"})}const v="/v1";let E;$("#changeColor").click(function(){let t=p(64,255),e=p(192,255),o=p(230,242);document.body.style.setProperty("--instanceColor",e),document.body.style.setProperty("--globeColor",t),document.body.style.setProperty("--mainColor",o),this.style.color=p(0,64)}),$(".linkLi").click(function(){window.location.href=this.title}),$(".mask").click(function(){$(this).hide()}),$("#urlCount").click(function(){f(),h("刷新URL数目成功^o^")}),$(".go").click(function(){window.open($("#shorturl").text(),"_blank")}),new ClipboardJS("#copy-button"),$("#router *").click(function(){g(this.title)}),$(".login").bind("keyup",function(t){13===t.keyCode&&$('.login button[title="login"]').click()}),$(".routeBtn").click(function(){switch(console.log(this.title),this.title){case"edit_code":case"edit_note":case"edit_delete":case"edit_natter":$(".edit_content>div").hide(),$("."+this.title).show();break;case"getShortUrl":var o=$("#url").val();if(!m(o))return void h("不规范的URL,请重新输入噢 😘");const{username:i}=u()||{};var n={url:o,username:i};$.post(v+"/short",n,function(t){let e=window.location.protocol+"//"+window.location.host+"/"+t.data.code;console.log(e),$(".mask").show(),$("#shorturl").text(e),$("#qrcode").html(""),$("#qrcode").qrcode(e),$("#copy-button").attr("data-clipboard-text",e),$(".input-container").val(""),f()});break;case"toLogin":g("login");break;case"toRegister":g("register");break;case"query":e();break;case"forget":h();break;case"login":const a=t().login||{};a.username?a.password?r(a):h("PASSWORD REQUIRED"):h("USERNAME REQUIRED");break;case"register":const c=t().register||{};c.username?c.password?c.confirmPassword?c.password!==c.confirmPassword?h("PLZ KEEP THE PASSWORD SAME"):s(c):h("CONFIRM PASSWORD REQUIRED"):h("PASSWORD REQUIRED"):h("USERNAME REQUIRED")}}),$(".some").click(function(){switch(console.log(this.title),this.title){case"logout":a()}}),f(),g("short"),w(),c(),$(".edit_code>button").click(function(){$.post(v+"/short/setCode",{id:E,code:$(".edit_code>input").val()},t=>{200===t.code?e():h("CODE已存在，试试别的😃")})}),$(".edit_note>button").click(function(){$.post(v+"/short/setUrlNote",{id:E,note:$(".edit_note>input").val()},t=>{200===t.code?e():h("编辑失败了，请过段时间再试，我也不知道啥错误🤔")})}),$(".edit_delete>button").click(function(){$.post(v+"/short/delete",{id:E},t=>{200===t.code?e():h("删除失败😆")})})});
