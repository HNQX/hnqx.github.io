<script src="./knockout-3.5.1.js"></script>
<style>
    :root {
        --gradColor: #a4e2c6
    }

    .btnArr button {
        border: 1px solid transparent;
        transition: all .5s;
        padding: 8px;
        border-radius: 20%;
    }

    .btnArr button:hover {
        background: var(--gradColor) !important;
    }

    .btnArr button:focus {
        outline: none;
    }

    .center {
        text-align: center;
    }
</style>
<div class="main">
    <div>
        <div class="btnArr" data-bind="click:btnClick">
            <button data-bind="style:{background:curShow()==='edit'?activeColor():noActiveColor()}"
                value="edit">ç¼–è¾‘</button>
            <button data-bind="style:{background:curShow()==='note'?activeColor():noActiveColor()}"
                value="note">å¤‡æ³¨</button>
            <button data-bind="style:{background:curShow()==='natter'?activeColor():noActiveColor()}"
                value="natter">æ ‡ç­¾</button>
            <button data-bind="style:{background:curShow()==='delete'?activeColor():noActiveColor()}"
                value="delete">åˆ é™¤</button>
        </div>
    </div>
    <hr size="1">
    <div class="center" data-bind="visible:curShow()==='edit'">
        <span>code</span>
        <input data-bind="value:curInfo().code" type="text">
        <button data-bind="click:editCode">ä¿®æ”¹</button>
    </div>
    <div class="center" data-bind="visible:curShow()==='note'">
        <span>note</span>
        <input data-bind="value:curInfo().note" type="text">
        <button data-bind="click:editNote">ä¿®æ”¹</button>
    </div>
    <div class="center" data-bind="visible:curShow()==='natter'">
        <input readonly disabled data-bind="value:curInfo().withNatter">
    </div>
    <div class="center" data-bind="visible:curShow()==='delete'">
        <button data-bind="click:confirmDelete">ç¡®å®š</button>
    </div>
</div>
<script>
    const APIVERSION = '/v1'
    let query
    const VM = {
        noActiveColor: ko.observable('#bacac6'),
        activeColor: ko.observable('#7fecad'),
        curShow: ko.observable('edit'),
        curId: ko.observable(parent.$(parent.document).find('.active')[0].title),
        curInfo: ko.observable(''),
        btnClick: function (v, e) {
            v.curShow(e.target.value)
        },
        editCode: function (v, e) {
            _editCode(), _close()
        },
        editNote: function (v, e) {
            _editNote(), _close()
        },
        confirmDelete: function (v, e) {
            _delete(), _close()
        }
    }
    ko.applyBindings(VM)

    get()
    function get() { parent.$.post(APIVERSION + '/short/getCodeWithId', { id: VM.curId() }, r => (r.code === 200) && (VM.curInfo(r.data[0]))) }

    function _editCode() {
        parent.$.post(APIVERSION + '/short/setCode', { id: VM.curId(), code: VM.curInfo().code }, r => {
            if (r.code === 200) { query() } else info('CODEå·²å­˜åœ¨ï¼Œè¯•è¯•åˆ«çš„ğŸ˜ƒ')
        })
    }
    function _delete() {
        parent.$.post(APIVERSION + '/short/delete', { id: VM.curId() }, r => {
            if (r.code === 200) { query() } else info('åˆ é™¤å¤±è´¥ğŸ˜†')
        })
    }

    function _editNote() {
        parent.$.post(APIVERSION + '/short/setUrlNote', { id: VM.curId(), note: VM.curInfo().note }, r => {
            if (r.code === 200) { query() } else info('ç¼–è¾‘å¤±è´¥äº†ï¼Œè¯·è¿‡æ®µæ—¶é—´å†è¯•ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å•¥é”™è¯¯ğŸ¤”')
        })
    }
    function setRow(e) {
        query = e
    }

    function info(msg) { parent.layer.msg(msg || 'æ–½å·¥ä¸­ã€‚ã€‚ï¼ˆï¼›Â´Ğ´ï½€ï¼‰ã‚', { offset: '10%', time: 2500 }) }

    function _close() { parent.layer.closeAll() }
</script>